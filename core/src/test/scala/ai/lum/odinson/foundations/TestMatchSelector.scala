package ai.lum.odinson.foundations

import ai.lum.odinson.Document
import ai.lum.odinson.utils.TestUtils.OdinsonTest

class TestMatchSelector extends OdinsonTest  {

  val t1 = Seq("The", "first", "project", ",", "amounting", "to", "about", "330", "million", "dollars", "will", "finance", "several", "small", "to", "medium", "hydropower", "plants", "in", "the", "Northwest", "Frontier", "Province", "and", "Punjab", ",", "the", "ADB", "said", "in", "a", "statement", "from", "its", "headquarters", "in", "Manila", ".")
  val doc1 = """{"id":"60fded9b-1b9f-4843-9ec6-853b9de4402d","metadata":[],"sentences":[{"numTokens":38,"fields":[{"$type":"ai.lum.odinson.TokensField","name":"raw","tokens":["The","first","project",",","amounting","to","about","330","million","dollars","will","finance","several","small","to","medium","hydropower","plants","in","the","Northwest","Frontier","Province","and","Punjab",",","the","ADB","said","in","a","statement","from","its","headquarters","in","Manila","."]},{"$type":"ai.lum.odinson.TokensField","name":"word","tokens":["The","first","project",",","amounting","to","about","330","million","dollars","will","finance","several","small","to","medium","hydropower","plants","in","the","Northwest","Frontier","Province","and","Punjab",",","the","ADB","said","in","a","statement","from","its","headquarters","in","Manila","."]},{"$type":"ai.lum.odinson.TokensField","name":"tag","tokens":["DT","JJ","NN",",","VBG","TO","IN","CD","CD","NNS","MD","VB","JJ","JJ","TO","NN","NN","NNS","IN","DT","NNP","NNP","NNP","CC","NNP",",","DT","NNP","VBD","IN","DT","NN","IN","PRP$","NN","IN","NNP","."]},{"$type":"ai.lum.odinson.TokensField","name":"lemma","tokens":["the","first","project",",","amount","to","about","330","million","dollar","will","finance","several","small","to","medium","hydropower","plant","in","the","Northwest","Frontier","Province","and","Punjab",",","the","ADB","say","in","a","statement","from","its","headquarters","in","Manila","."]},{"$type":"ai.lum.odinson.TokensField","name":"entity","tokens":["O","ORDINAL","O","O","O","O","O","MONEY","MONEY","MONEY","O","O","O","O","O","O","O","O","O","O","ORGANIZATION","ORGANIZATION","ORGANIZATION","O","LOCATION","O","O","ORGANIZATION","O","O","O","O","O","O","O","O","CITY","O"]},{"$type":"ai.lum.odinson.TokensField","name":"chunk","tokens":["B-NP","I-NP","I-NP","O","B-VP","B-PP","B-NP","I-NP","I-NP","I-NP","B-VP","I-VP","B-NP","I-NP","I-NP","I-NP","I-NP","I-NP","B-PP","B-NP","I-NP","I-NP","I-NP","I-NP","I-NP","O","B-NP","I-NP","B-VP","B-PP","B-NP","I-NP","B-PP","B-NP","I-NP","B-PP","B-NP","O"]},{"$type":"ai.lum.odinson.GraphField","name":"dependencies","edges":[[22,23,"cc"],[27,26,"det"],[28,27,"nsubj"],[34,33,"nmod:poss"],[9,5,"case"],[2,0,"det"],[2,3,"punct"],[22,18,"case"],[28,37,"punct"],[31,29,"case"],[2,4,"acl"],[9,8,"nummod"],[31,34,"nmod_from"],[13,12,"amod"],[13,17,"nmod_to"],[8,7,"compound"],[17,16,"compound"],[36,35,"case"],[34,36,"nmod_in"],[11,2,"nsubj"],[28,11,"ccomp"],[31,30,"det"],[17,15,"compound"],[34,32,"case"],[22,21,"compound"],[22,19,"det"],[11,10,"aux"],[28,25,"punct"],[11,24,"nmod_in"],[8,6,"advmod"],[17,14,"case"],[11,13,"dobj"],[4,9,"nmod_to"],[2,1,"amod"],[28,31,"nmod_in"],[11,22,"nmod_in"],[22,20,"compound"],[22,24,"conj_and"]],"roots":[28]}]}]}"""

  val t2 = Seq("KARMANOS", "-LRB-", "undated", "-RRB-", "-", "Nearly", "three", "years", "after", "separating", "from", "the", "Detroit", "Medical", "Center", "to", "form", "its", "own", "freestanding", "hospital", ",", "the", "Barbara", "Ann", "Karmanos", "Cancer", "Institute", "in", "Detroit", "is", "still", "struggling", "to", "expand", "beyond", "its", "space", "on", "the", "DMC", "'s", "Midtown", "campus", ".")
  val doc2 = """{"id":"dd7336d2-301e-44e9-b0b8-de5b77060baa","metadata":[],"sentences":[{"numTokens":46,"fields":[{"$type":"ai.lum.odinson.TokensField","name":"raw","tokens":["KARMANOS","-LRB-","undated","-RRB-","-","Nearly","three","years","after","separating","from","the","Detroit","Medical","Center","to","form","its","own","freestanding","hospital",",","the","Barbara","Ann","Karmanos","Cancer","Institute","in","Detroit","is","still","struggling","to","expand","beyond","its","space","on","the","DMC","'","s","Midtown","campus","."]},{"$type":"ai.lum.odinson.TokensField","name":"word","tokens":["KARMANOS","-LRB-","undated","-RRB-","-","Nearly","three","years","after","separating","from","the","Detroit","Medical","Center","to","form","its","own","freestanding","hospital",",","the","Barbara","Ann","Karmanos","Cancer","Institute","in","Detroit","is","still","struggling","to","expand","beyond","its","space","on","the","DMC","'","s","Midtown","campus","."]},{"$type":"ai.lum.odinson.TokensField","name":"tag","tokens":["NN","-LRB-","JJ","-RRB-",":","RB","CD","NNS","IN","VBG","IN","DT","NNP","NNP","NNP","TO","VB","PRP$","JJ","JJ","NN",",","DT","NNP","NNP","NNP","NNP","NNP","IN","NNP","VBZ","RB","VBG","TO","VB","IN","PRP$","NN","IN","DT","NNP","POS","NNS","JJ","NN","."]},{"$type":"ai.lum.odinson.TokensField","name":"lemma","tokens":["karmanos","-lrb-","undated","-rrb-","-","nearly","three","year","after","separate","from","the","Detroit","Medical","Center","to","form","its","own","freestanding","hospital",",","the","Barbara","Ann","Karmanos","Cancer","Institute","in","Detroit","be","still","struggle","to","expand","beyond","its","space","on","the","DMC","'","s","midtown","campus","."]},{"$type":"ai.lum.odinson.TokensField","name":"entity","tokens":["PERSON","O","O","O","O","DATE","DATE","DATE","DATE","O","O","O","ORGANIZATION","ORGANIZATION","ORGANIZATION","O","O","O","O","O","O","O","O","ORGANIZATION","ORGANIZATION","ORGANIZATION","ORGANIZATION","ORGANIZATION","O","CITY","O","O","O","O","O","O","O","O","O","O","ORGANIZATION","O","O","LOCATION","O","O"]},{"$type":"ai.lum.odinson.TokensField","name":"chunk","tokens":["B-NP","O","B-ADJP","O","O","B-NP","I-NP","I-NP","B-PP","B-VP","B-PP","B-NP","I-NP","I-NP","I-NP","B-VP","I-VP","B-NP","I-NP","I-NP","I-NP","O","B-NP","I-NP","I-NP","I-NP","I-NP","I-NP","B-PP","B-NP","B-VP","I-VP","I-VP","I-VP","I-VP","B-PP","B-NP","I-NP","B-PP","B-NP","I-NP","B-NP","I-NP","I-NP","I-NP","O"]},{"$type":"ai.lum.odinson.GraphField","name":"dependencies","edges":[[20,19,"amod"],[0,32,"dep"],[32,34,"xcomp"],[29,28,"case"],[37,35,"case"],[27,22,"det"],[44,43,"amod"],[2,3,"punct"],[7,5,"advmod"],[7,6,"nummod"],[16,15,"mark"],[34,37,"nmod_beyond"],[34,27,"nsubj:xsubj"],[7,9,"dep"],[7,8,"mark"],[40,41,"case"],[2,1,"punct"],[14,11,"det"],[27,25,"compound"],[27,29,"nmod_in"],[32,31,"advmod"],[40,39,"det"],[27,24,"compound"],[14,13,"compound"],[16,20,"dobj"],[32,7,"dep"],[0,4,"punct"],[32,21,"punct"],[14,10,"case"],[37,36,"nmod:poss"],[0,2,"appos"],[44,42,"compound"],[20,17,"nmod:poss"],[14,12,"compound"],[27,23,"compound"],[37,44,"nmod_on"],[34,33,"mark"],[32,30,"aux"],[44,38,"case"],[20,18,"amod"],[32,27,"nsubj"],[27,26,"compound"],[9,14,"nmod_from"],[9,16,"xcomp"],[0,45,"punct"],[44,40,"nmod:poss"]],"roots":[0]}]}]}"""

  val t3 = Seq("NameMedia", ",", "which", "began", "in", "1999", "as", "YesDirect", ",", "was", "reintroduced", "in", "May", "2006", "with", "an", "undisclosed", "amount", "of", "equity", "financing", "from", "Highland", "Capital", "Partners", "and", "Summit", "Partners", ",", "two", "Boston", "venture", "capital", "groups", ",", "and", "more", "than", "$", "100", "million", "in", "debt", "financing", "from", "Goldman", "Sachs", ".")
  val doc3 = """{"id":"3401ff4d-9db3-4ea8-a3bc-ae94d2a852e8","metadata":[],"sentences":[{"numTokens":48,"fields":[{"$type":"ai.lum.odinson.TokensField","name":"raw","tokens":["NameMedia",",","which","began","in","1999","as","YesDirect",",","was","reintroduced","in","May","2006","with","an","undisclosed","amount","of","equity","financing","from","Highland","Capital","Partners","and","Summit","Partners",",","two","Boston","venture","capital","groups",",","and","more","than","$","100","million","in","debt","financing","from","Goldman","Sachs","."]},{"$type":"ai.lum.odinson.TokensField","name":"word","tokens":["NameMedia",",","which","began","in","1999","as","YesDirect",",","was","reintroduced","in","May","2006","with","an","undisclosed","amount","of","equity","financing","from","Highland","Capital","Partners","and","Summit","Partners",",","two","Boston","venture","capital","groups",",","and","more","than","$","100","million","in","debt","financing","from","Goldman","Sachs","."]},{"$type":"ai.lum.odinson.TokensField","name":"tag","tokens":["NNP",",","WDT","VBD","IN","CD","IN","NNP",",","VBD","VBN","IN","NNP","CD","IN","DT","JJ","NN","IN","NN","NN","IN","NNP","NNP","NNPS","CC","NNP","NNPS",",","CD","NNP","NN","NN","NNS",",","CC","JJR","IN","$","CD","CD","IN","NN","NN","IN","NNP","NNP","."]},{"$type":"ai.lum.odinson.TokensField","name":"lemma","tokens":["NameMedia",",","which","begin","in","1999","as","YesDirect",",","be","reintroduce","in","May","2006","with","a","undisclosed","amount","of","equity","financing","from","Highland","Capital","Partners","and","Summit","Partners",",","two","Boston","venture","capital","group",",","and","more","than","$","100","million","in","debt","financing","from","Goldman","Sachs","."]},{"$type":"ai.lum.odinson.TokensField","name":"entity","tokens":["ORGANIZATION","O","O","O","O","DATE","O","O","O","O","O","O","DATE","DATE","O","O","O","O","O","O","O","O","ORGANIZATION","ORGANIZATION","ORGANIZATION","ORGANIZATION","ORGANIZATION","ORGANIZATION","O","NUMBER","CITY","O","O","O","O","O","O","O","MONEY","MONEY","MONEY","O","O","O","O","ORGANIZATION","ORGANIZATION","O"]},{"$type":"ai.lum.odinson.TokensField","name":"chunk","tokens":["B-NP","O","B-NP","B-VP","B-PP","B-NP","B-PP","B-NP","O","B-VP","I-VP","B-PP","B-NP","I-NP","B-PP","B-NP","I-NP","I-NP","B-PP","B-NP","I-NP","B-PP","B-NP","I-NP","I-NP","I-NP","I-NP","I-NP","O","B-NP","I-NP","I-NP","I-NP","I-NP","O","O","B-NP","I-NP","I-NP","I-NP","I-NP","B-PP","B-NP","I-NP","B-PP","B-NP","I-NP","O"]},{"$type":"ai.lum.odinson.GraphField","name":"dependencies","edges":[[12,13,"nummod"],[38,36,"advmod"],[10,12,"nmod_in"],[3,7,"nmod_as"],[38,43,"nmod_in"],[33,32,"compound"],[43,42,"compound"],[5,4,"case"],[12,11,"case"],[10,9,"auxpass"],[33,38,"conj_and"],[0,8,"punct"],[43,41,"case"],[10,0,"nsubjpass"],[24,23,"compound"],[33,30,"compound"],[17,15,"det"],[33,31,"compound"],[24,27,"conj_and"],[17,24,"nmod_from"],[24,25,"cc"],[40,39,"compound"],[0,3,"acl:relcl"],[3,5,"nmod_in"],[17,16,"amod"],[20,19,"compound"],[33,35,"cc"],[46,44,"case"],[38,40,"nummod"],[28,38,"root"],[17,20,"nmod_of"],[17,27,"nmod_from"],[17,14,"case"],[0,2,"ref"],[33,47,"punct"],[36,37,"mwe"],[33,29,"nummod"],[0,1,"punct"],[24,21,"case"],[28,33,"root"],[33,34,"punct"],[20,18,"case"],[38,46,"nmod_from"],[10,28,"punct"],[27,26,"compound"],[3,0,"nsubj"],[7,6,"case"],[46,45,"compound"],[24,22,"compound"],[10,17,"nmod_with"]],"roots":[10]}]}]}"""

  val x ="[tag=NN | tag=NNS] [word=said]? [word=in]? [word=two]? [word=the]? [word=city]? [tag=NN]? [tag=IN]? [word=its]? [tag=NN]? [tag=CC]? [tag=NN]? [tag=NN]? [word=and]? [tag=NNS]? [tag=IN]? ([tag=\",\"]? [tag=CC]?)+ ([word=□ | □] □ □)?"

//  val pattern ="[tag=NN | tag=NNS] [word=said]? [word=in]? [word=two]? [word=the]? [word=city]? [tag=NN]? [tag=IN]? [word=its]? [tag=NN]? [tag=CC]? [tag=NN]? [tag=NN]? [word=and]? [tag=NNS]? [tag=IN]? ([tag=\",\"]? [tag=CC]?)+"

  val pattern ="""[tag=NN] [word=said]? [word=in]? [word=two]? [word=the]? [word=city]? [tag=NN]? [tag=IN]? [word=its]? [tag=NN]? [tag=CC]? [tag=NN]? [tag=NN]? [word=and]? [tag=NNS]? [tag=IN]? [tag=","]? [tag=CC]? [tag=","]? [tag=CC]? ([tag=","]? [tag=CC]?)+ ([word=the])?"""

  "MatchSelector" should "handle pattern" in {
    val e1 = mkExtractorEngine(Document.fromJson(doc1))
    val e2 = mkExtractorEngine(Document.fromJson(doc2))
    val e3 = mkExtractorEngine(Document.fromJson(doc3))
    val results1 = e1.query(e1.compiler.compile(pattern))
    val results2 = e2.query(e1.compiler.compile(pattern))
    val results3 = e3.query(e1.compiler.compile(pattern))
    val a = 1
    ()
  }





}
